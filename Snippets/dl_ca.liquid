<!-- TagCommander datalayer by DZ 2021 -->
<script type="text/javascript">
  var tc_current_product = {};
  var tc_current_product_list = [];
  var tc_current_cart = {};
  var tc_current_cart_item = {};
  var tc_current_cart_item_list = [];
  var tc_current_checkout_item_list = [];
  var tc_current_checkout_item = {};
{% if cart %}
  tc_current_cart = {
  	"cart_item_count": "{{ cart.item_count }}",
  	"cart_total_price": "{{ cart.total_price | money_without_currency }}",
    "cart_original_total_price": "{{ cart.original_total_price | money_without_currency }}",
    "cart_total_discount": "{{ cart.total_discount | money_without_currency }}",
    "cart_currency": "{{ cart.currency.iso_code }}",
  };
  {% for item in cart.items %}
  	tc_current_cart_item = {
      "product_id": "{{ item.product_id }}",
      "product_qty": "{{ item.quantity }}",
      "product_unitprice": "{{ item.price | money_without_currency }}",
      "product_name": "{{ item.title }}",
      "product_sku": "{{ item.sku }}",
      "product_vendor": "{{ item.vendor }}",
  	}
    tc_current_cart_item_list.push(tc_current_cart_item);
  {% endfor %}
  	tc_current_cart.item_list = tc_current_cart_item_list;
{% endif %}
{% if checkout %}
  {% for item in checkout.line_items %}
  	tc_current_checkout_item = {
      "product_id":"{{ item.product_id }}",
      "product_sku":"{{ item.sku }}",
      "product_vendor":"{{ item.vendor }}",
      "product_qty": "{{ item.quantity }}",
      "product_name": "{{ item.title }}",
      "product_unitprice":"{{ item.unit_price | money_without_currency }}",
      "product_originalprice":"{{ item.original_price | money_without_currency }}",
  	}
    tc_current_checkout_item_list.push(tc_current_checkout_item);
  {% endfor %}
{% endif %}
{% if template.name == 'product' %}
  tc_current_product = {
    "product_id" : "{{ product.id }}",
    "product_name" : "{{ product.title }}",
    "product_url": "{{ product.url }}",
    "product_vendor": "{{ product.vendor }}",
    {% for variant in product.variants %}
      {% if variant.price == product.price_min %}
        "product_unitprice" : "{{ variant.price | money_without_currency }}",
        "product_variant_id" : "{{ variant.id }}",
      {% endif %}
    {% endfor %}
  }
  tc_current_product_list.push(tc_current_product);
{% elsif template.name == 'cart' %}
{% elsif template.name == 'search' %}
  {% for item in search.results %}
  	{% if item.object_type == 'product' %}
  		  tc_current_product = {
    		"product_id" : "{{ item.id }}",
    		"product_name" : "{{ item.title }}",
    		"product_vendor" : "{{ item.vendor }}",
    		"product_url": "{{ item.url }}",
    		{% for variant in item.variants %}
      			{% if variant.price == item.price_min %}
        			"product_unitprice" : "{{ variant.price | money_without_currency }}",
        			"product_variant_id" : "{{ variant.id }}",
      			{% endif %}
    		{% endfor %}
  		}
  tc_current_product_list.push(tc_current_product);
  	{% endif %}
  {% endfor %}
{% elsif template.name == 'collection' %}
    {% for product in collection.products %}
  		  tc_current_product = {
    		"product_id" : "{{ product.id }}",
    		"product_name" : "{{ product.title }}",
            "product_url": "{{ product.url }}",
    		"product_vendor": "{{ product.vendor }}",
    		{% for variant in product.variants %}
      			{% if variant.price == product.price_min %}
			        "product_unitprice" : "{{ variant.price | money_without_currency }}",
        			"product_variant_id" : "{{ variant.id }}",
      			{% endif %}
    		{% endfor %}
  			}
          tc_current_product_list.push(tc_current_product);
	{% endfor %} 
{% endif %}
  var tc_vars = {
    "site_section": "{{ section }}",
    "env_template": {% if template.name %} "{{ template.name }}" {% elsif checkout %} (function() { if(Shopify.Checkout && Shopify.Checkout.page == 'thank_you'){ return "order_confirmation" } else { return "checkout" }})(){% else %} ""  {% endif %},
    "ca_environment":"{{ settings.ca_environment }}",
	"shop_locale": "{{ shop.locale }}",
    "shop_currency":"{{ shop.currency }}",
{% if customer %}
	"customer_logged": "1",
	"customer_id": "{{ customer.id }}",
    "customer_email": "{{ customer.email }}",
	"customer_first_name": "{{ customer.first_name }}",
	"customer_last_name": "{{ customer.last_name }}",
 	{% if customer.default_address %}
    	"country_code": "{{ customer.default_address.country_code }}",
	{% endif %}
{% else %}
  "user_logged": "0",
{% endif %}
    "product_list": tc_current_product_list,
    "cart": tc_current_cart,
{% if template.name == 'search' %}
    "search_keywords": "{{ search.terms }}",
{% endif %}  
{% if checkout %}
    //checkout  variables
    "checkout_order_id": "{{ checkout.order_id }}",
    "checkout_order_number": "{{ checkout.order_number }}",
    "checkout_shipping_price": "{{ checkout.shipping_price | money_without_currency }}",
    "checkout_total_price": "{{ checkout.total_price | money_without_currency }}",
    "checkout_tax_price": "{{ checkout.tax_price | money_without_currency }}",
    "checkout_currency":"{{ checkout.currency }}",
    "checkout_items": tc_current_checkout_item_list,
{% endif %}
  };
{% if settings.ca_environment != ''  %}
// add here any console logging
{% endif %}
</script>